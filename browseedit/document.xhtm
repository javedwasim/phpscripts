<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /><title /><meta name="generator" content="StarOffice/OpenOffice.org XSLT (http://xml.openoffice.org/sx2ml)" /><meta name="created" content="2007-11-12T23:30:19" /><meta name="changedby" content="Cesar D. Rodas" /><meta name="changed" content="2007-11-13T00:45:10" /><base href="." /><style type="text/css">
	@page { size: 20.999cm 29.699cm; margin-top: 2cm; margin-bottom: 2cm; margin-left: 2cm; margin-right: 2cm }
	table { border-collapse:collapse; border-spacing:0; empty-cells:show }
	td, th { vertical-align:top; }
	h1, h2, h3, h4, h5, h6 { clear:both }
	ol, ul { padding:0; }
	* { margin:0; }
	*.P1 { color:#000000; font-family:Arial; font-size:12pt; text-align:center ! important; }
	*.P10 { color:#000000; font-family:Arial; font-size:12pt; text-align:left ! important; font-weight:normal; }
	*.P11 { color:#000000; font-family:Arial; font-size:12pt; text-align:left ! important; font-weight:normal; }
	*.P12 { color:#000000; font-family:Arial; font-size:12pt; text-align:left ! important; font-weight:normal; }
	*.P13 { color:#000000; font-family:Arial; font-size:12pt; text-align:left ! important; font-style:normal; font-weight:normal; }
	*.P2 { color:#000000; font-family:Arial; font-size:12pt; text-align:left ! important; font-weight:bold; }
	*.P3 { color:#000000; font-family:Arial; font-size:12pt; text-align:left ! important; }
	*.P4 { color:#000000; font-family:Arial; font-size:12pt; text-align:left ! important; }
	*.P5 { color:#000000; font-family:Arial; font-size:12pt; text-align:left ! important; font-weight:bold; }
	*.P6 { color:#000000; font-family:Arial; font-size:12pt; text-align:left ! important; font-weight:normal; }
	*.P7 { color:#000000; font-family:Arial; font-size:12pt; text-align:left ! important; font-weight:normal; }
	*.P8 { color:#000000; font-family:'Times New Roman'; font-size:12pt; background-color:#c0c0c0; margin-left:0.009cm; margin-right:0.009cm; text-align:left ! important; text-indent:0.026cm; }
	*.P9 { color:#000000; font-family:'Times New Roman'; font-size:12pt; background-color:#c0c0c0; text-align:left ! important; }
	*.Standard { color:#000000; font-family:'Times New Roman'; font-size:12pt; }
	*.TableContents { color:#000000; font-family:'Times New Roman'; font-size:12pt; background-color:transparent; }
	*.Tabla1 { width:13.88cm; float:none; }
	*.Tabla2 { width:16.999cm; float:none; }
	*.Tabla1A1 { padding:0.097cm; border-width:0.0133cm; border-style:solid; border-color:#000000; }
	*.Tabla2A1 { padding:0.097cm; border-width:0.0133cm; border-style:solid; border-color:#000000; }
	*.Tabla1A { width:13.871cm; }
	*.Tabla2A { width:16.999cm; }
	*.BulletSymbols { font-family:StarSymbol; font-size:9pt; }
	*.Internetlink { color:#000080; text-decoration:underline; }
	*.NumberingSymbols { }
	*.SourceText { font-family:'Courier New'; }
	*.T1 { font-size:20pt; }
	*.T10 { font-style:italic; font-weight:bold; }
	*.T11 { font-style:italic; }
	*.T12 { font-weight:bold; }
	*.T13 { font-style:normal; }
	*.T2 { }
	*.T3 { font-weight:normal; }
	*.T4 { font-weight:normal; }
	*.T5 { font-family:'Courier New'; color:#004000; font-size:10pt; }
	*.T6 { font-family:'Courier New'; color:#c00000; font-size:10pt; }
	*.T7 { font-family:'Courier New'; color:#808080; font-size:10pt; }
	*.T8 { font-family:'Courier New'; color:#0000bb; font-size:10pt; }
	*.T9 { font-family:'Courier New'; color:#004000; }
	</style></head><body dir="ltr"><p class="P1"><a href="http://cesars.users.phpclasses.org/dba"><span class="T1">DataBase Abstraction Layer Class</span></a><br /></p><p class="P1"><a href="http://www.cesarodas.com/">Cesar D. Rodas</a> <br /><a href="mailto:cesar@sixdegrees.com.br">cesar@sixdegrees.com.br</a></p><p class="P1">Â </p><p class="P2">What is DBAL ?Â </p><p class="P3">Â </p><p class="P3">DBAL is class that abstracts <span class="T2">database operations with an unique interface to access data</span></p><p class="P4">Â </p><p class="P4">Â </p><p class="P5">Why use DBAL?Â </p><ul style="margin-left:1.25cm;"><li class="P6" style="margin-left:0cm;"><p class="P6" style="margin-left:0.25cm;">Fully compatible between PHP 4, PHP5: because DBAL was wrote for run on computer with PHP4 and PHP5. DBAL is Â not an external compiled library, so it can be easily Â installed. </p><p class="P6" style="margin-left:0.25cm;">Â </p></li><li class="P6" style="margin-left:0cm;"><p class="P6" style="margin-left:0.25cm;">Easy to implements: Comes with a familiar interface, similar to PDO.Â </p><p class="P6" style="margin-left:0.25cm;">Â </p></li><li class="P6" style="margin-left:0cm;"><p class="P6" style="margin-left:0.25cm;">Come with an cache-system built-in to avoid, this feature increase performance, because DBAL only connects to database when it is absolutely needed.Â </p><p class="P6" style="margin-left:0.25cm;">Â </p></li><li class="P6" style="margin-left:0cm;"><p class="P6" style="margin-left:0.25cm;">Free an Open source class, protected under a BSD license, which permits to include the source in closed sources projects without any fee.Â </p><p class="P6" style="margin-left:0.25cm;">Â </p></li><li class="P6" style="margin-left:0cm;"><p class="P6" style="margin-left:0.25cm;">Free support on <a href="http://cesars.users.phpclasses.org/browse/package/4222.html">PHP Classes Forum</a></p></li></ul><p class="P7">Â </p><p class="P7">Â </p><p class="P5">How to installÂ </p><p class="P5">Â </p><p class="P4"><span class="T3">Download the tarball from </span><a href="http://cesars.users.phpclasses.org/browse/package/4222/download/targz.html"><span class="T4">here</span></a><span class="T3">, copy the folder â€œdbal/â€ into your project folder. Then read the example of how o execute and statement, and query to database.</span></p><p class="P4">Â </p><p class="P5">Executing an SQL statement ?Â </p><p class="P4">Â </p><div style="text-align:center"><table border="0" cellspacing="0" cellpadding="0" class="Tabla1"><colgroup><col width="606" /></colgroup><tr><td style="text-align:left;width:13.871cm; " class="Tabla1A1"><p class="P8"><span class="T5">require(</span><span class="T6">"</span><span class="SourceText"><span class="T6">dbal/</span></span><span class="T6">dbal.php"</span><span class="T5">); <br /></span><span class="T7">/* connect */ <br /></span><span class="T8">$dbh </span><span class="T5">= new </span><span class="T8">dbal</span><span class="T5">(</span><span class="T6">"mysql://user:pass@host/db"</span><span class="T5">); <br /></span><span class="T7">/* set cache, directory*/ <br /></span><span class="T8">$dbh</span><span class="T5">-&gt;</span><span class="T8">setCacheDir</span><span class="T5">(</span><span class="T6">"./cache"</span><span class="T5">); <br /></span><span class="T7">/* execute an SQL */ <br /></span><span class="T8">$dbh</span><span class="T5">-&gt;</span><span class="T8">execute</span><span class="T5">(</span><span class="T6">"create table foo(bar integer, xFoo varchar(250))"</span><span class="T5">); <br /></span><span class="T7">/* compile an SQL */ <br /></span><span class="T8">$dbh</span><span class="T5">-&gt;</span><span class="T8">compile</span><span class="T5">(</span><span class="T6">"insert into foo values(:bar, :xFoo)"</span><span class="T5">); <br /></span><span class="T7">/* Execute SQL, passing parameters */ <br /></span><span class="T5">for(</span><span class="T8">$i</span><span class="T5">=</span><span class="T8">0</span><span class="T5">;</span><span class="T8">$i</span><span class="T5">&lt;</span><span class="T8">50</span><span class="T5">; </span><span class="T8">$i</span><span class="T5">++) <br />Â Â Â Â </span><span class="T8">$dbh</span><span class="T5">-&gt;</span><span class="T8">execute</span><span class="T5">( array(</span><span class="T6">'bar'</span><span class="T5">=&gt;</span><span class="T8">$i</span><span class="T5">, </span><span class="T6">'xFoo'</span><span class="T5">=&gt;</span><span class="T6">"xfoo vale $i"</span><span class="T5">) );</span><span class="T9"> </span></p><p class="P8"><span class="T7">/* Execute SQL, passing </span><span class="SourceText"><span class="T7">parameters</span></span><span class="T7"> */ </span></p></td></tr></table></div><p class="P4">Â </p><p class="P7">Execute and SQL statement, does not retrieve any data from database, only return true if success or false on errorÂ </p><p class="P5">Â </p><p class="P5">Retrieving data from database ?Â </p><div style="text-align:left"><table border="0" cellspacing="0" cellpadding="0" class="Tabla2"><colgroup><col width="743" /></colgroup><tr><td style="text-align:left;width:16.999cm; " class="Tabla2A1"><p class="P9"><span class="T5">require(</span><span class="T6">"dbal/dbal.php"</span><span class="T5">); <br /></span><span class="T7">/* connect */ <br /></span><span class="T8">$dbh </span><span class="T5">= new </span><span class="T8">dbal</span><span class="T5">(</span><span class="T6">"</span><span class="SourceText"><span class="T6">mysql://user:pass@host/db</span></span><span class="T6">"</span><span class="T5">); <br /></span><span class="T7">/* set cache, directory*/ <br /></span><span class="T8">$dbh</span><span class="T5">-&gt;</span><span class="T8">setCacheDir</span><span class="T5">(</span><span class="T6">"./cache"</span><span class="T5">); <br /></span><span class="T7">Â Â Â Â </span><span class="T8">$dbh</span><span class="T5">-&gt;</span><span class="T8">compile</span><span class="T5">(</span><span class="T6">"select * from foo where bar between :min and :max"</span><span class="T5">); <br />Â Â Â Â </span><span class="T7">/* the result is cache for 60 seconds */ <br />Â Â Â Â </span><span class="T8">$record </span><span class="T5">= </span><span class="T8">$dbh</span><span class="T5">-&gt;</span><span class="T8">query</span><span class="T5">(array(</span><span class="T6">'min'</span><span class="T5">=&gt;</span><span class="T8">5</span><span class="T5">, </span><span class="T6">'max' </span><span class="T5">=&gt; </span><span class="T8">40</span><span class="T5">), </span><span class="T8">60</span><span class="T5">); <br />Â Â Â Â </span><span class="T7">/** <br />Â Â Â Â Â *Â Â Â Â Equivalent to: <br />Â Â Â Â Â *Â Â Â Â $record = $dbh-&gt;query("select * from foo where bar between :min and :max",array('min'=&gt;5, 'max' =&gt; 40), 60); <br />Â Â Â Â Â */ <br />Â Â Â Â </span><span class="T5">if (!</span><span class="T8">$record</span><span class="T5">) { <br />Â Â Â Â Â Â Â Â echo </span><span class="T8">$dbh</span><span class="T5">-&gt;</span><span class="T8">getLastError</span><span class="T5">(); <br />Â Â Â Â } else { <br />Â Â Â Â Â Â Â Â </span><span class="T7">/* bind parameters */ <br />Â Â Â Â Â Â Â Â </span><span class="T8">$barÂ Â </span><span class="T5">= &amp; </span><span class="T8">$record</span><span class="T5">-&gt;</span><span class="T8">bindColumn</span><span class="T5">(</span><span class="T6">'bar'</span><span class="T5">); <br />Â Â Â Â Â Â Â Â </span><span class="T8">$xFoo </span><span class="T5">= &amp; </span><span class="T8">$record</span><span class="T5">-&gt;</span><span class="T8">bindColumn</span><span class="T5">(</span><span class="T6">'xFoo'</span><span class="T5">); <br />Â Â Â Â Â Â Â Â </span><span class="T7">/* also the result is saved on $f*/ <br />Â Â Â Â Â Â Â Â </span><span class="T5">while ( </span><span class="T8">$f </span><span class="T5">= </span><span class="T8">$record</span><span class="T5">-&gt;</span><span class="T8">getNext</span><span class="T5">() ) { <br />Â Â Â Â Â Â Â Â Â Â Â Â echo </span><span class="T6">"$bar = $xFoo&lt;br&gt;"</span><span class="T5">; <br />Â Â Â Â Â Â Â Â Â Â Â Â </span><span class="T8">print_r</span><span class="T5">(</span><span class="T8">$f</span><span class="T5">); <br />Â Â Â Â Â Â Â Â Â Â Â Â echo </span><span class="T6">"&lt;hr&gt;"</span><span class="T5">; <br />Â Â Â Â Â Â Â Â } <br />Â Â Â Â } </span></p></td></tr></table></div><p class="P5">Â </p><p class="P7">If an SQL query is success it returns an object of â€œdbm_resultâ€. Â </p><p class="P7">Â </p><p class="P5">DBAL methodsÂ </p><ul style="margin-left:1.25cm;"><li class="P10" style="margin-left:0cm;"><p class="P10" style="margin-left:0.25cm;"><span class="T10">dbal(string $connStr=''):</span> Construct Â the class, and set the connection string if it is not null.</p><p class="P10" style="margin-left:0.25cm;">Â </p></li><li class="P10" style="margin-left:0cm;"><p class="P10" style="margin-left:0.25cm;"><span class="T10">void Connect(string $cnnStr):</span> Set the connection string.</p><p class="P10" style="margin-left:0.25cm;">Â </p></li><li class="P10" style="margin-left:0cm;"><p class="P10" style="margin-left:0.25cm;"><span class="T10">bool Execute(string $query,[array $params])</span><span class="T11">:</span> Compile SQL statement, and execute</p><p class="P10" style="margin-left:0.25cm;">Â </p></li><li class="P10" style="margin-left:0cm;"><p class="P10" style="margin-left:0.25cm;"><span class="T10">bool Execute([array $params]):</span> Execute a SQL already compiled SQL statement</p><p class="P10" style="margin-left:0.25cm;">Â </p></li><li class="P10" style="margin-left:0cm;"><p class="P10" style="margin-left:0.25cm;"><span class="T10">void Compile(string $str):</span><span class="T12"> </span>Compile an SQL statement.</p><p class="P10" style="margin-left:0.25cm;">Â </p></li><li class="P10" style="margin-left:0cm;"><p class="P10" style="margin-left:0.25cm;"><span class="T10">mixed Query(string $query,[array $params,[integer $TTL] ]):</span> Compile SQL statement, then save the results $TTL seconds on hard disk.</p></li><li class="P10" style="margin-left:0cm;"><p class="P10" style="margin-left:0.25cm;"><span class="T10">mixed Query([array $params,[integer $TTL] ]):</span> Execute a SQL already compiled, then save the results $TTL seconds on hard disk.</p><p class="P10" style="margin-left:0.25cm;">Â </p></li><li class="P10" style="margin-left:0cm;"><p class="P10" style="margin-left:0.25cm;"><span class="T10">Void Close(): </span>Â close database connection (if it were opened) and release buffer memory</p><p class="P10" style="margin-left:0.25cm;">Â </p></li><li class="P10" style="margin-left:0cm;"><p class="P10" style="margin-left:0.25cm;"><span class="T10">string getLastError(): </span>Returns an string with he last error</p><p class="P10" style="margin-left:0.25cm;">Â </p></li><li class="P10" style="margin-left:0cm;"><p class="P10" style="margin-left:0.25cm;"><span class="T10">void setCacheDir(string $path): </span>Set $path as cache directory.</p><p class="P10" style="margin-left:0.25cm;">Â </p></li><li class="P10" style="margin-left:0cm;"><p class="P10" style="margin-left:0.25cm;"><span class="T10">string GetCacheDir():</span> Returns the actual cache directory</p><p class="P10" style="margin-left:0.25cm;">Â </p></li></ul><p class="P5">Â </p><p class="P5">dbm_result methodsÂ </p><ul style="margin-left:1.25cm;"><li class="P11" style="margin-left:0cm;"><p class="P11" style="margin-left:0.25cm;"><span class="T10">array fetchAll(): </span>Returns all the datas from database ( an array of array);</p><p class="P11" style="margin-left:0.25cm;">Â </p></li><li class="P11" style="margin-left:0cm;"><p class="P11" style="margin-left:0.25cm;"><span class="T10">&amp;bindColumn(string $columnName):</span> Bind the $columnName from database to a local varaible, so, at every time that you call the method getNext(), the binded variable will have the value of the column.</p><p class="P11" style="margin-left:0.25cm;">Â </p></li><li class="P11" style="margin-left:0cm;"><p class="P11" style="margin-left:0.25cm;"><span class="T10">Void SetBegin():</span> This move the cursor of the results at begin, so when you call getNext(), the return result will be the frist row.</p><p class="P11" style="margin-left:0.25cm;">Â </p></li><li class="P11" style="margin-left:0cm;"><p class="P11" style="margin-left:0.25cm;"><span class="T10">Mixed GetNext():</span> Returns an array() with all the columns and also binds all column variables, if there is not rows to retrieve returns false </p></li></ul><p class="P7">Â </p><p class="P7">Â </p><p class="P5">How to add support for new databaseÂ </p><p class="P5">Â </p><p class="P7">If you want to add support for a â€œfooâ€ database, the connection string will be similar to this â€œfoo://user:pass@host/db-nameâ€.Â </p><p class="P7">For this you must create a file â€œfoo.phpâ€ into the â€œdbm/â€ folder. In that file you must create an class â€œfooâ€ that extends â€œdbm_modelâ€.Â </p><p class="P7">In that function you must override the following methods:Â </p><p class="P7">Â </p><ul style="margin-left:1.25cm;"><li class="P12" style="margin-left:0cm;"><p class="P12" style="margin-left:0.25cm;">string doEscape(string $str): It must escape a given $str and return.Â </p><p class="P12" style="margin-left:0.25cm;">Â </p></li><li class="P12" style="margin-left:0cm;"><p class="P12" style="margin-left:0.25cm;">bool _open(array $open): This must open a database and save the connection as a private property, recommend to save in <span class="T11">$this-&gt;dbh</span><span class="T13">. $open has index â€œhostâ€, â€œuserâ€, â€œpassâ€, â€œdbâ€. It must return true if success, on otherwise false.</span></p><p class="P13" style="margin-left:0.25cm;">Â </p></li><li class="P13" style="margin-left:0cm;"><p class="P13" style="margin-left:0.25cm;">void _close(): must close the database connection (<span class="T11">$this-&gt;dbh</span>).</p><p class="P13" style="margin-left:0.25cm;">Â </p></li><li class="P13" style="margin-left:0cm;"><p class="P13" style="margin-left:0.25cm;">array _query(string $sql): Must execute an SQL $sql, and return an array of array with the result.Â </p><p class="P13" style="margin-left:0.25cm;">Â </p></li><li class="P13" style="margin-left:0cm;"><p class="P13" style="margin-left:0.25cm;">bool _execute($string $sql): The same of _query, but must not return any result, only true or falseÂ </p><p class="P13" style="margin-left:0.25cm;">Â </p></li><li class="P13" style="margin-left:0cm;"><p class="P13" style="margin-left:0.25cm;">string _getError(): Return last error Â </p></li></ul></body></html>